<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scroll Video Background</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    /* Background video layer */
    .bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }

    .bg video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 300ms linear;
      will-change: opacity;
    }

    /* Foreground content */
    .fg {
      position: relative;
      z-index: 1;
    }

    .panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }

    /* PNGs scale to browser width */
    img {
      width: 100vw;
      max-width: 100vw;
      height: auto;
      display: block;
    }
  </style>
</head>

<body>

  <!-- Background videos -->
  <div class="bg" aria-hidden="true">
    <video data-key="a" autoplay muted loop playsinline src="video-01.mp4"></video>
    <video data-key="b" autoplay muted loop playsinline src="video-02.mp4"></video>
    <video data-key="c" autoplay muted loop playsinline src="video-03.mp4"></video>
  </div>

  <!-- Foreground content (PNGs) -->
  <main class="fg">
    <section class="panel" data-video="a">
      <img src="image-01.png" alt="">
    </section>

    <section class="panel" data-video="b">
      <img src="image-02.png" alt="">
    </section>

    <section class="panel" data-video="c">
      <img src="image-03.png" alt="">
    </section>
  </main>

  <script>
    const videos = [...document.querySelectorAll('.bg video')];
    const panels = [...document.querySelectorAll('.panel')];
    const map = new Map(videos.map(v => [v.dataset.key, v]));

    let active = panels[0]?.dataset.video;
    if (map.get(active)) map.get(active).style.opacity = 1;

    function score(panel) {
      const r = panel.getBoundingClientRect();
      const vh = window.innerHeight || 1;
      const center = vh / 2;
      const panelCenter = r.top + r.height / 2;
      return 1 - Math.min(1, Math.abs(panelCenter - center) / (vh * 0.6));
    }

    function update() {
      let bestPanel = null;
      let bestScore = -1;

      for (const p of panels) {
        const s = score(p);
        if (s > bestScore) { bestScore = s; bestPanel = p; }
      }
      if (!bestPanel) return;

      const key = bestPanel.dataset.video;
      if (key === active) return;

      active = key;
      for (const v of videos) {
        const on = (v.dataset.key === key);
        v.style.opacity = on ? 1 : 0;
        if (on && v.paused) v.play().catch(()=>{});
      }
    }

    let ticking = false;
    function onScroll() {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(() => {
        update();
        ticking = false;
      });
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onScroll);
  </script>

</body>
</html>

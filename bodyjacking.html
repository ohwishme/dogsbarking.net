<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scroll Video Background</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Background video layer */
    .bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }

    .bg video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 300ms linear;
      will-change: opacity;
    }

    /* Foreground content */
    .fg {
      position: relative;
      z-index: 1;
    }

    .panel {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
      text-align: center;
      padding: 8vh 8vw;
    }

    h1, h2 {
      margin: 0;
      font-weight: 500;
      line-height: 1.1;
    }

    p {
      max-width: 700px;
      margin: 0;
      opacity: 0.9;
      line-height: 1.5;
    }

    img {
      max-width: min(520px, 100%);
      height: auto;
      border-radius: 16px;
      display: block;
    }
  </style>
</head>

<body>

  <!-- Background videos -->
  <div class="bg" aria-hidden="true">
    <video data-key="a" autoplay muted loop playsinline src="image_01.jpg"></video>
    <video data-key="b" autoplay muted loop playsinline src="video-02.mp4"></video>
    <video data-key="c" autoplay muted loop playsinline src="video-03.mp4"></video>
  </div>

  <!-- Foreground content -->
  <main class="fg">
    <section class="panel" data-video="a">
      <h1>Title One</h1>
      <img src="placeholder_body_01.png" alt="">
      <p>Minimal centered content.</p>
    </section>

    <section class="panel" data-video="b">
      <h2>Title Two</h2>
      <img src="placeholder_body_02.png" alt="">
      <p>Pure foreground layer.</p>
    </section>

    <section class="panel" data-video="c">
      <h2>Title Three</h2>
      <img src="placeholder_body_03.png" alt="">
      <p>No containers. No borders.</p>
    </section>
  </main>

  <script>
    const videos = [...document.querySelectorAll('.bg video')];
    const panels = [...document.querySelectorAll('.panel')];
    const map = new Map(videos.map(v => [v.dataset.key, v]));

    let active = panels[0]?.dataset.video;
    if (map.get(active)) map.get(active).style.opacity = 1;

    function score(panel) {
      const r = panel.getBoundingClientRect();
      const vh = window.innerHeight;
      const center = vh / 2;
      const panelCenter = r.top + r.height / 2;
      return 1 - Math.min(1, Math.abs(panelCenter - center) / (vh * 0.6));
    }

    function update() {
      let bestPanel = null;
      let bestScore = -1;

      for (const p of panels) {
        const s = score(p);
        if (s > bestScore) {
          bestScore = s;
          bestPanel = p;
        }
      }

      if (!bestPanel) return;

      const key = bestPanel.dataset.video;
      if (key === active) return;

      active = key;
      for (const v of videos) {
        v.style.opacity = v.dataset.key === key ? 1 : 0;
        if (v.dataset.key === key && v.paused) v.play().catch(()=>{});
      }
    }

    let ticking = false;
    function onScroll() {
      if (!ticking) {
        requestAnimationFrame(() => {
          update();
          ticking = false;
        });
        ticking = true;
      }
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onScroll);
  </script>

</body>
</html>

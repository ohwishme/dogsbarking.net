<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bodyjacking Proof of Concept</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    /* Background video layer */
    .bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }

    .bg video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 350ms linear;
      will-change: opacity;
    }

    /* Foreground content */
    .fg {
      position: relative;
      z-index: 1;
    }

    .panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }

    img {
      width: 100vw;
      max-width: 100vw;
      height: auto;
      display: block;
    }
  </style>
</head>

<body>

  <!-- Background videos -->
  <div class="bg" aria-hidden="true">
    <video data-key="a" autoplay muted loop playsinline preload="auto" src="video-01.mp4"></video>
    <video data-key="b" autoplay muted loop playsinline preload="auto" src="video-02.mp4"></video>
    <video data-key="c" autoplay muted loop playsinline preload="auto" src="video-03.mp4"></video>
  </div>

  <!-- Foreground content (PNGs) -->
  <main class="fg">
    <section class="panel" data-video="a">
      <img src="placeholder_body_01.png" alt="">
    </section>

    <section class="panel" data-video="b">
      <img src="placeholder_body_02.png" alt="">
    </section>

    <section class="panel" data-video="c">
      <img src="placeholder_body_03.png" alt="">
    </section>
  </main>

  <script>
    const videos = [...document.querySelectorAll('.bg video')];
    const panels = [...document.querySelectorAll('.panel')];

    const map = new Map(videos.map(v => [v.dataset.key, v]));
    let activeKey = panels[0]?.dataset.video || videos[0]?.dataset.key;

    function setActive(key) {
      if (!map.has(key) || key === activeKey) return;

      activeKey = key;
      for (const v of videos) {
        const on = (v.dataset.key === activeKey);
        v.style.opacity = on ? 1 : 0;

        // keep all videos running so switching is instant
        if (v.paused) v.play().catch(()=>{});
      }
    }

    // Determine which panel is most "centered" in the viewport
    function centeredPanelKey() {
      const vh = window.innerHeight || 1;
      const centerY = vh * 0.5;

      let bestKey = activeKey;
      let bestDist = Infinity;

      for (const p of panels) {
        const r = p.getBoundingClientRect();

        // ignore panels completely offscreen
        if (r.bottom <= 0 || r.top >= vh) continue;

        const pCenter = r.top + r.height * 0.5;
        const dist = Math.abs(pCenter - centerY);

        if (dist < bestDist) {
          bestDist = dist;
          bestKey = p.dataset.video;
        }
      }
      return bestKey;
    }

    function update() {
      setActive(centeredPanelKey());
    }

    // rAF throttling
    let ticking = false;
    function onScroll() {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(() => {
        update();
        ticking = false;
      });
    }

    // Initialize: start all videos (muted) for reliable switching, show first
    for (const v of videos) v.play().catch(()=>{});
    for (const v of videos) v.style.opacity = (v.dataset.key === activeKey) ? 1 : 0;

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onScroll);
    update();
  </script>

</body>
</html>



</body>
</html>
